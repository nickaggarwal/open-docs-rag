<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Basic Widget Example</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        margin: 0;
        padding: 40px;
        background-color: #f5f7fa;
        color: #333;
        line-height: 1.6;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #2d3748;
        margin-bottom: 30px;
        text-align: center;
      }
      .section {
        margin: 30px 0;
        padding: 20px;
        background: #f8fafc;
        border-radius: 8px;
        border-left: 4px solid #4299e1;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 6px;
        font-weight: 500;
      }
      .status.success {
        background: #f0fff4;
        color: #2f855a;
        border: 1px solid #9ae6b4;
      }
      .status.error {
        background: #fed7d7;
        color: #c53030;
        border: 1px solid #feb2b2;
      }
      button {
        background: #4299e1;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin: 5px;
        transition: background 0.2s;
      }
      button:hover {
        background: #3182ce;
      }
      #debug-info {
        background: #1a202c;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        margin-top: 20px;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🚀 Open Docs RAG Widget - Basic Example</h1>

      <div class="section">
        <h3>Widget Status</h3>
        <div id="widget-status" class="status">Loading widget...</div>
      </div>

      <div class="section">
        <h3>Quick Tests</h3>
        <button onclick="testWidget()">Test Widget Functions</button>
        <button onclick="openWidget()">Open Widget</button>
        <button onclick="closeWidget()">Close Widget</button>
        <button onclick="checkStyles()">Check CSS Styles</button>
      </div>

      <div class="section">
        <h3>Widget Features</h3>
        <p>✅ Fixed position button in bottom-right corner</p>
        <p>✅ Modal popup with semi-transparent overlay</p>
        <p>✅ Responsive design</p>
        <p>✅ Close on ESC key or click outside</p>
        <p>✅ Example questions</p>
        <p>✅ Chat interface (mock API)</p>
      </div>

      <div id="debug-info"></div>
    </div>

    <script type="module">
      // Import the widget - CSS will be injected automatically
      import { createWidget } from './dist/index.esm.js';

      let widget = null;
      const debugLog = [];

      function log(message) {
        console.log(message);
        debugLog.push(`${new Date().toLocaleTimeString()}: ${message}`);
        updateDebugInfo();
      }

      function updateDebugInfo() {
        document.getElementById('debug-info').innerHTML = debugLog.slice(-10).join('\n');
      }

      function updateStatus(message, type = 'success') {
        const status = document.getElementById('widget-status');
        status.textContent = message;
        status.className = `status ${type}`;
      }

      // Test functions
      window.testWidget = function () {
        if (!widget) {
          updateStatus('Widget not initialized!', 'error');
          return;
        }

        log('Testing widget functions...');
        const container = document.querySelector('.open-docs-rag-widget-container');
        const button = document.querySelector('.open-docs-rag-widget-button');
        const modal = document.querySelector('.open-docs-rag-widget-modal');

        if (container) log('✅ Widget container found');
        else log('❌ Widget container not found');

        if (button) log('✅ Widget button found');
        else log('❌ Widget button not found');

        if (modal) log('✅ Widget modal found');
        else log('❌ Widget modal not found');
      };

      window.openWidget = function () {
        if (widget) {
          log('Opening widget...');
          widget.open();
        } else {
          log('Widget not available');
        }
      };

      window.closeWidget = function () {
        if (widget) {
          log('Closing widget...');
          widget.close();
        } else {
          log('Widget not available');
        }
      };

      window.checkStyles = function () {
        const container = document.querySelector('.open-docs-rag-widget-container');
        if (!container) {
          log('❌ Widget container not found for style check');
          return;
        }

        const styles = window.getComputedStyle(container);
        log(`Position: ${styles.position}`);
        log(`Bottom: ${styles.bottom}`);
        log(`Right: ${styles.right}`);
        log(`Z-index: ${styles.zIndex}`);

        const button = document.querySelector('.open-docs-rag-widget-button');
        if (button) {
          const buttonStyles = window.getComputedStyle(button);
          log(`Button background: ${buttonStyles.backgroundColor}`);
          log(`Button width: ${buttonStyles.width}`);
          log(`Button height: ${buttonStyles.height}`);
        }
      };

      try {
        log('Initializing widget...');

        widget = createWidget({
          websiteId: 'basic-example',
          projectName: 'Demo Widget',
          projectColor: '#4299e1',
          projectLogo:
            'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjNDI5OWUxIi8+Cjwvc3ZnPgo=',
          modalExampleQuestions: 'What is this widget?, How do I integrate it?, Can I customize the styling?',
          modalDisclaimer: 'This is a demo widget. In a real implementation, connect this to your documentation API.',
          apiEndpoint: '#', // Mock endpoint
          modalTitle: 'AI Documentation Assistant'
        });

        log('Widget created successfully!');
        updateStatus('Widget initialized successfully!');

        // Give widget time to render
        setTimeout(() => {
          testWidget();
        }, 100);
      } catch (error) {
        log(`Error initializing widget: ${error.message}`);
        updateStatus(`Failed to initialize widget: ${error.message}`, 'error');
      }

      // Add a mock API response handler since we don't have a real endpoint
      const originalFetch = window.fetch;
      window.fetch = function (url, options) {
        if (url === '#') {
          // Mock API response
          return Promise.resolve({
            ok: true,
            json: () =>
              Promise.resolve({
                answer:
                  'This is a mock response! In a real implementation, this would connect to your documentation API and provide intelligent responses based on your content.',
                sources: ['https://docs.example.com/getting-started', 'https://docs.example.com/api-reference']
              })
          });
        }
        return originalFetch.apply(this, arguments);
      };
    </script>
  </body>
</html>
